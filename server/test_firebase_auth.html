<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase Auth Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 50px auto;
            padding: 20px;
        }
        .container {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
        }
        input, button {
            padding: 10px;
            margin: 5px 0;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .token-display {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            word-wrap: break-word;
            font-family: monospace;
            font-size: 12px;
        }
        .error {
            color: red;
            margin: 10px 0;
        }
        .success {
            color: green;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>Firebase Authentication Test</h2>
        
        <div>
            <h3>Step 1: Sign In with Firebase</h3>
            <input type="email" id="email" placeholder="Email (admin@example.com)" value="admin@example.com">
            <input type="password" id="password" placeholder="Password" value="StrongPass123!">
            <button onclick="signIn()">Sign In</button>
        </div>
        
        <div id="result"></div>
        
        <div id="tokenSection" style="display: none;">
            <h3>Step 2: Firebase ID Token</h3>
            <p>Copy this token to test your backend:</p>
            <div class="token-display" id="tokenDisplay"></div>
            <button onclick="copyToken()">Copy Token</button>
        </div>
        
        <div id="backendTestSection" style="display: none;">
            <h3>Step 3: Test Backend Login</h3>
            <select id="roleSelect">
                <option value="admin">Admin</option>
                <option value="student">Student</option>
                <option value="client">Client</option>
            </select>
            <button onclick="testBackendLogin()">Test Backend Login</button>
            <div id="backendResult"></div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyCILm6KI3G0WtqIBB93S3xw_6nw7GEvLcE",
            authDomain: "innovation-marketplace-6c9b1.firebaseapp.com",
            projectId: "innovation-marketplace-6c9b1",
            storageBucket: "innovation-marketplace-6c9b1.firebasestorage.app",
            messagingSenderId: "604242171569",
            appId: "1:604242171569:web:4a84949fa97fe3c0147490",
            measurementId: "G-48EV1SD56Z"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        
        let currentIdToken = null;

        // Make functions globally available
        window.signIn = async function() {
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                // Get ID token
                currentIdToken = await user.getIdToken();
                
                resultDiv.innerHTML = `
                    <div class="success">
                        ✅ Firebase Sign In Successful!<br>
                        User: ${user.email}<br>
                        UID: ${user.uid}
                    </div>
                `;
                
                // Show token section
                document.getElementById('tokenSection').style.display = 'block';
                document.getElementById('tokenDisplay').textContent = currentIdToken;
                document.getElementById('backendTestSection').style.display = 'block';
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ❌ Error: ${error.message}
                    </div>
                `;
            }
        };

        window.copyToken = function() {
            const tokenDisplay = document.getElementById('tokenDisplay');
            navigator.clipboard.writeText(tokenDisplay.textContent).then(() => {
                alert('Token copied to clipboard!');
            });
        };

        window.testBackendLogin = async function() {
            if (!currentIdToken) {
                alert('Please sign in first');
                return;
            }
            
            const role = document.getElementById('roleSelect').value;
            const backendResult = document.getElementById('backendResult');
            
            try {
                const response = await fetch('http://localhost:5000/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        idToken: currentIdToken,
                        role: role
                    }),
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    backendResult.innerHTML = `
                        <div class="success">
                            ✅ Backend Login Successful!<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                } else {
                    backendResult.innerHTML = `
                        <div class="error">
                            ❌ Backend Error:<br>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            } catch (error) {
                backendResult.innerHTML = `
                    <div class="error">
                        ❌ Network Error: ${error.message}
                    </div>
                `;
            }
        };
    </script>
</body>
</html>
